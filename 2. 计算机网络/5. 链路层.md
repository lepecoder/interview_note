## 链路层

> 网络层提供主机到主机的数据传输，而链路层负责是数据报跨越一系列不同的通信链路。
> 因此链路层提供的服务就是在物理链路上直接相连的两个节点间传输数据。
>

### 链路层提供的服务：

- 成帧framing
  网络层的数据要经过链路层的帧封装，链路层将网络层的数据报封装在数据字段，并加上链路层需要的首部字段。
- 链路接入
  媒体访问控制(MAC)协议用来协调多个节点的帧传输。
- 可靠交付
  提供相邻接点的可靠交付，避免在传输层进行端到端的重传，仅在产生差错的链路上进行点到点的重传，多用于易产生差错的无线链路。
- 差错检测和纠正
  用于检测bit差错，["循环容易校验"](siyuan://blocks/20210422163431-5clczft)不仅能检测bit差错，还能确定差错的位置并纠正。

* 封装成帧：将网络层传下来的分组前后分别添加首部和尾部，这样就构成了帧。首部和尾部的一个重要作用是帧定界，也携带了一些必要的控制信息，对于每种数据链路层协议都规定了帧的数据部分的最大长度。
* 透明传输：帧使用首部和尾部进行定界，如果帧的数据部分含有和首部和尾部相同的内容， 那么帧的开始和结束的位置就会判断错，因此需要在数据部分中出现有歧义的内容前边插入转义字符，如果数据部分出现转义字符，则在该转义字符前再加一个转义字符。在接收端进行处理之后可以还原出原始数据。这个过程透明传输的内容是转义字符，用户察觉不到转义字符的存在。
* 差错检测：目前数据链路层广泛使用循环冗余检验（CRC）来检查数据传输过程中是否产生比特差错。

### 两类链路

#### 点对点链路

只有单个的发送方和单个的接收方，P2P协议和HDLC协议就是运行在点对点链路上的。

#### 广播链路

可以让多个发送方和多个接收方连接到单一、共享的广播信道，因为是广播信道，所以任何节点传输一个帧时，其它每个节点都能收到一个副本。以太网和无线局域网都是广播链路。

["多路访问控制协议"](siyuan://blocks/20210422172444-zl0y09p)(MAC)用来规范在共享广播信道上的通信行为。

## 为什么有了 MAC 地址还需要 IP 地址

如果我们只使用 MAC 地址进行寻址的话，我们需要路由器记住每个 MAC 地址属于哪一个子网，不然每一次路由器收到数据包时都要满世界寻找目的 MAC 地址。而我们知道 MAC 地址的长度为 48 位，也就是说最多总共有 2 的 48 次方个 MAC 地址，这就意味着每个路由器需要 256 T 的内存，这显然是不现实的。

和 MAC 地址不同，IP 地址是和地域相关的，在一个子网中的设备，我们给其分配的 IP 地址前缀都是一样的，这样路由器就能根据 IP 地址的前缀知道这个设备属于哪个子网，剩下的寻址就交给子网内部实现，从而大大减少了路由器所需要的内存。